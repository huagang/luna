<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd" >
<sqlMap namespace="ms_merchant_manage">
	<resultMap id="MerchantsResult" class="ms.luna.biz.dao.custom.model.MerchantsResult">
		<result column="MERCHANT_ID" property="merchant_id" jdbcType="VARCHAR2" />
		<result column="MERCHANT_NM" property="merchant_nm" jdbcType="VARCHAR2" />
		<result column="CATEGORY_ID" property="category_id" jdbcType="VARCHAR2" />
		<result column="CONTACT_NM" property="contact_nm" jdbcType="VARCHAR2" />
		<result column="CONTACT_PHONENUM" property="contact_phonenum" jdbcType="VARCHAR2" />
		<result column="SALESMAN_NM" property="salesman_nm" jdbcType="VARCHAR2" />
		<result column="STATUS_ID" property="status_id" jdbcType="VARCHAR2" />
		<result column="PROVINCE_ID" property="province_id" jdbcType="VARCHAR2" />
		<result column="CITY_ID" property="city_id" jdbcType="VARCHAR2" />
		<result column="COUNTY_ID" property="county_id" jdbcType="VARCHAR2" />
		<result column="CATEGORY_NM" property="category_nm" jdbcType="VARCHAR2" />
		<result column="DEL_FLG" property="del_flg" jdbcType="VARCHAR2" />
		
		
	</resultMap>
	<select id="selectAllMerchantsWithFilter" resultMap="MerchantsResult"
		parameterClass="ms.luna.biz.dao.custom.model.MerchantsParameter">
		
		SELECT
				merchants.merchant_id AS MERCHANT_ID,
				merchants.merchant_nm AS MERCHANT_NM,
				merchants.category_id AS CATEGORY_ID,
				merchants.contact_nm AS CONTACT_NM,
				merchants.contact_phonenum AS CONTACT_PHONENUM,
				merchants.salesman_nm AS SALESMAN_NM,
				merchants.status_id AS STATUS_ID,
				merchants.province_id AS PROVINCE_ID,
				merchants.city_id AS CITY_ID,
				merchants.county_id AS COUNTY_ID,
				merchants.del_flg AS DEL_FLG,
				categorys.nm_zh AS CATEGORY_NM
		FROM
		(
			SELECT
				ms_merchant_manage.merchant_id,
				ms_merchant_manage.merchant_nm,
				ms_merchant_manage.category_id,
				ms_merchant_manage.contact_nm,
				ms_merchant_manage.contact_phonenum,
				ms_merchant_manage.salesman_nm,
				ms_merchant_manage.status_id,
				ms_merchant_manage.province_id,
				ms_merchant_manage.city_id,
				ms_merchant_manage.county_id,
				ms_merchant_manage.del_flg,
				ms_merchant_manage.regist_hhmmss
			FROM
				ms_merchant_manage
			<dynamic prepend="where">
				<isNotEmpty prepend="and" property="provinceId">
					province_id = #provinceId#
				</isNotEmpty>
				<isNotEmpty prepend="and" property="cityId">
					city_id = #cityId#
				</isNotEmpty>
				<isNotEmpty prepend="and" property="countyId">
					county_id = #countyId#
				</isNotEmpty>
				<isNotEmpty prepend="and" property="likeFilterNm">
					merchant_nm like #likeFilterNm#
				</isNotEmpty>
			</dynamic>
			ORDER BY regist_hhmmss DESC
			<isNotNull property="range">
				Limit #min#,#max#
			</isNotNull>
		) merchants left join
		(
			SELECT
				ms_category.nm_zh,
				ms_category.category_id
			FROM
				ms_category
		) categorys ON merchants.category_id=categorys.category_id
	</select>

	<select id="countMerchants" resultClass="java.lang.Integer"
		parameterClass="ms.luna.biz.dao.custom.model.MerchantsParameter">

		SELECT
			count(1)
		FROM
			ms_merchant_manage
		
		<isNotNull property="likeFilterNm">
			WHERE merchant_nm like #likeFilterNm#
		</isNotNull>
	</select>
	
	<resultMap id="merchantInfo" class="ms.luna.biz.dao.custom.model.MerchantsResult">
		<result column="MERCHANT_ID" property="merchant_id" jdbcType="VARCHAR2" />
		<result column="MERCHANT_NM" property="merchant_nm" jdbcType="VARCHAR2" />
	</resultMap>
	
	<select id="searchMerchantWithFilter" resultMap="merchantInfo"
		parameterClass="ms.luna.biz.dao.custom.model.MerchantsParameter">
			SELECT
				ms_merchant_manage.merchant_id,
				ms_merchant_manage.merchant_nm
			FROM
				ms_merchant_manage
			<dynamic prepend="where">
				<isNotEmpty prepend="and" property="provinceId">
					province_id = #provinceId#
				</isNotEmpty>
				<isNotEmpty prepend="and" property="cityId">
					city_id = #cityId#
				</isNotEmpty>
				<isNotEmpty prepend="and" property="countyId">
					county_id = #countyId#
				</isNotEmpty>
				<isNotEmpty prepend="and" property="likeFilterNm">
					merchant_nm like #likeFilterNm#
				</isNotEmpty>
			</dynamic>
			LIMIT 100;
	
	</select>

</sqlMap>
  